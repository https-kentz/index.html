<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EJNHS Event Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        /* Navigation */
        .nav-bar {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-bar h1 {
            font-size: 28px;
            margin-bottom: 15px;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: white;
            color: #007bff;
        }

        .nav-btn.active {
            background: white;
            color: #007bff;
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Registration Form Styles */
        .form-container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .required {
            color: #dc3545;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        input[type="date"],
        input[type="time"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #007bff;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        .qr-section {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 5px;
            border: 2px dashed #007bff;
        }

        #qr-code {
            display: inline-block;
            padding: 15px;
        }

        .download-btn, .back-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
        }

        .download-btn {
            background: #28a745;
            color: white;
        }

        .back-btn {
            background: #6c757d;
            color: white;
        }

        /* Calendar Styles */
        .calendar-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            flex-wrap: wrap;
            gap: 15px;
        }

        .month-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .month-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .current-month {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            min-width: 200px;
            text-align: center;
        }

        .legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .calendar {
            padding: 20px;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day {
            min-height: 100px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 8px;
            background: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .day.other-month {
            background: #f8f9fa;
            color: #adb5bd;
        }

        .day.today .day-number {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event-dot {
            width: 100%;
            padding: 4px 6px;
            margin: 2px 0;
            border-radius: 3px;
            font-size: 11px;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .event-avr {
            background: #667eea;
        }

        .event-court {
            background: #28a745;
        }

        .event-lab {
            background: #fd7e14;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            background: #007bff;
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            position: relative;
        }

        .modal-header h2 {
            margin: 0;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 28px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .event-detail {
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .event-detail h3 {
            margin-bottom: 10px;
        }

        .event-detail p {
            margin: 5px 0;
            color: #666;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .calendar-controls {
                flex-direction: column;
            }

            .days {
                gap: 5px;
            }

            .day {
                min-height: 80px;
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <div class="nav-bar">
        <h1>üìÖ EJNHS Event Management System</h1>
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showPage('registration')">üìù Registration</button>
            <button class="nav-btn" onclick="showPage('calendar')">üìÖ Calendar</button>
        </div>
    </div>

    <div class="main-content">
        <!-- Registration Page -->
        <div id="registration-page" class="page active">
            <!-- QR Code for Registration Link Section -->
            <div style="max-width: 700px; margin: 0 auto 20px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    <h3 style="color: white; margin-bottom: 10px;">üì± Share Registration Form</h3>
                    <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px; font-size: 14px;">Generate a QR code to share this registration form with others</p>
                    <button onclick="showRegistrationQR()" style="background: white; color: #667eea; border: none; padding: 12px 30px; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 16px; transition: transform 0.3s;">
                        üéØ Generate QR Code for Registration Link
                    </button>
                </div>
            </div>

            <div class="form-container">
                <div id="success-message" class="success-message">
                    <h3>‚úì Registration Successful!</h3>
                    <p>Your event has been added to the calendar!</p>
                    
                    <div class="qr-section">
                        <h3>üì± Your Registration QR Code</h3>
                        <div id="qr-code"></div>
                        <div>
                            <button class="download-btn" onclick="downloadQR()">üíæ Download QR</button>
                            <button class="back-btn" onclick="resetForm()">Register Another</button>
                        </div>
                    </div>

                    <div id="summary" style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;"></div>
                </div>

                <form id="registration-form" onsubmit="submitRegistration(event)">
                    <h2 style="margin-bottom: 20px; color: #007bff;">Event Registration</h2>

                    <div class="form-group">
                        <label>Event Title <span class="required">*</span></label>
                        <input type="text" id="event-title" required placeholder="Enter event title">
                    </div>

                    <div class="form-group">
                        <label>Event Date <span class="required">*</span></label>
                        <input type="date" id="event-date" required>
                    </div>

                    <div class="form-group">
                        <label>Event Time <span class="required">*</span></label>
                        <input type="time" id="event-time" required>
                    </div>

                    <div class="form-group">
                        <label>Location <span class="required">*</span></label>
                        <select id="location" required>
                            <option value="">Choose a location</option>
                            <option value="avr">Audio Visual Room</option>
                            <option value="court">Covered Court</option>
                            <option value="lab">Computer Laboratory</option>
                        </select>
                    </div>

                    <h2 style="margin: 30px 0 20px; color: #007bff;">Organizer Information</h2>

                    <div class="form-group">
                        <label>Full Name <span class="required">*</span></label>
                        <input type="text" id="fullname" required placeholder="Enter your full name">
                    </div>

                    <div class="form-group">
                        <label>Email Address <span class="required">*</span></label>
                        <input type="email" id="email" required placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label>Contact Number <span class="required">*</span></label>
                        <input type="tel" id="contact" required placeholder="+63 XXX XXX XXXX">
                    </div>

                    <div class="form-group">
                        <label>I am a: <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="student" name="participant-type" value="Student" required>
                                <label for="student" style="margin: 0; font-weight: normal;">Student</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="teacher" name="participant-type" value="Teacher">
                                <label for="teacher" style="margin: 0; font-weight: normal;">Teacher</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="parent" name="participant-type" value="Parent/Guardian">
                                <label for="parent" style="margin: 0; font-weight: normal;">Parent/Guardian</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="other" name="participant-type" value="Other">
                                <label for="other" style="margin: 0; font-weight: normal;">Other</label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">Submit Registration</button>
                </form>
            </div>
        </div>

        <!-- Calendar Page -->
        <div id="calendar-page" class="page">
            <div class="calendar-container">
                <div class="calendar-controls">
                    <div class="month-nav">
                        <button class="month-btn" onclick="previousMonth()">‚Üê Previous</button>
                        <div class="current-month" id="currentMonth"></div>
                        <button class="month-btn" onclick="nextMonth()">Next ‚Üí</button>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color event-avr"></div>
                            <span>AVR</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color event-court"></div>
                            <span>Covered Court</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color event-lab"></div>
                            <span>Computer Lab</span>
                        </div>
                    </div>
                </div>

                <div class="calendar">
                    <div class="weekdays">
                        <div class="weekday">Sun</div>
                        <div class="weekday">Mon</div>
                        <div class="weekday">Tue</div>
                        <div class="weekday">Wed</div>
                        <div class="weekday">Thu</div>
                        <div class="weekday">Fri</div>
                        <div class="weekday">Sat</div>
                    </div>
                    <div class="days" id="calendarDays"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalDate"></h2>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalEvents"></div>
        </div>
    </div>

    <!-- Registration Link QR Code Modal -->
    <div class="modal" id="registrationQRModal">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h2>üì± Registration Form QR Code</h2>
                <button class="close-btn" onclick="closeRegistrationQRModal()">√ó</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <p style="margin-bottom: 20px; color: #666; font-size: 15px;">
                    Share this QR code with students and staff. When scanned, it will direct them to this registration form.
                </p>
                
                <div style="padding: 20px; background: white; border: 2px dashed #667eea; border-radius: 10px; display: inline-block; margin-bottom: 20px;">
                    <div id="registration-link-qr"></div>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="font-size: 13px; color: #666; margin-bottom: 5px;">Current Page URL:</p>
                    <p id="current-url" style="font-family: monospace; color: #667eea; word-break: break-all; font-size: 14px;"></p>
                </div>

                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="download-btn" onclick="downloadRegistrationQR()" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;">
                        üíæ Download QR Code
                    </button>
                    <button class="back-btn" onclick="printRegistrationQR()" style="padding: 12px 24px; background: #17a2b8; color: white; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;">
                        üñ®Ô∏è Print QR Code
                    </button>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-left: 4px solid #667eea; border-radius: 5px; text-align: left;">
                    <h4 style="color: #667eea; margin-bottom: 10px; font-size: 16px;">üí° How to Use:</h4>
                    <ol style="margin-left: 20px; color: #555; font-size: 14px; line-height: 1.8;">
                        <li>Download or print this QR code</li>
                        <li>Place it on posters, flyers, or bulletin boards</li>
                        <li>Students/staff scan with their phones</li>
                        <li>They'll be directed to this registration form</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        // Events storage
        let events = [];
        let nextId = 1;
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let currentQRCode = null;
        let registrationData = null;

        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('event-date').setAttribute('min', today);

        // Page Navigation
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(pageName + '-page').classList.add('active');
            event.target.classList.add('active');

            if (pageName === 'calendar') {
                renderCalendar();
            }
        }

        // Registration Form Submit
        function submitRegistration(e) {
            e.preventDefault();

            const registrationId = 'REG-' + Date.now();
            const eventTitle = document.getElementById('event-title').value;
            const eventDate = document.getElementById('event-date').value;
            const timeInput = document.getElementById('event-time').value;
            const location = document.getElementById('location').value;
            
            // Convert time
            const [hours, minutes] = timeInput.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            const time = `${hour12}:${minutes} ${ampm}`;

            const locationNames = {
                'avr': 'Audio Visual Room',
                'court': 'Covered Court',
                'lab': 'Computer Laboratory'
            };

            registrationData = {
                id: nextId++,
                registrationId: registrationId,
                date: eventDate,
                time: time,
                title: eventTitle,
                location: location,
                locationName: locationNames[location],
                organizer: document.getElementById('fullname').value,
                email: document.getElementById('email').value,
                contact: document.getElementById('contact').value,
                participantType: document.querySelector('input[name="participant-type"]:checked').value,
                registeredOn: new Date().toLocaleString()
            };

            // Add to events array
            events.push(registrationData);

            // Generate QR Code
            generateQRCode(registrationData);

            // Show success message
            displaySummary(registrationData);
            document.getElementById('registration-form').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';

            window.scrollTo(0, 0);
        }

        function generateQRCode(data) {
            const qrContainer = document.getElementById('qr-code');
            qrContainer.innerHTML = '';

            const qrData = `EJNHS EVENT REGISTRATION
Registration ID: ${data.registrationId}
Event: ${data.title}
Date: ${data.date}
Time: ${data.time}
Location: ${data.locationName}
Organizer: ${data.organizer}
Contact: ${data.contact}`;

            currentQRCode = new QRCode(qrContainer, {
                text: qrData,
                width: 250,
                height: 250,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        function downloadQR() {
            const qrCanvas = document.querySelector('#qr-code canvas');
            if (qrCanvas) {
                const url = qrCanvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = url;
                link.download = `${registrationData.registrationId}_QRCode.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function displaySummary(data) {
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <p><strong>Registration ID:</strong> ${data.registrationId}</p>
                <p><strong>Event:</strong> ${data.title}</p>
                <p><strong>Date:</strong> ${data.date}</p>
                <p><strong>Time:</strong> ${data.time}</p>
                <p><strong>Location:</strong> ${data.locationName}</p>
                <p><strong>Organizer:</strong> ${data.organizer}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Contact:</strong> ${data.contact}</p>
                <p><strong>Type:</strong> ${data.participantType}</p>
            `;
        }

        function resetForm() {
            document.getElementById('registration-form').reset();
            document.getElementById('registration-form').style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
            registrationData = null;
            currentQRCode = null;
        }

        // Calendar Functions
        function renderCalendar() {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const prevLastDay = new Date(currentYear, currentMonth, 0);
            const firstDayIndex = firstDay.getDay();
            const lastDayIndex = lastDay.getDay();
            const nextDays = 7 - lastDayIndex - 1;

            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];

            document.getElementById('currentMonth').textContent = `${months[currentMonth]} ${currentYear}`;

            let days = '';

            for (let x = firstDayIndex; x > 0; x--) {
                days += `<div class="day other-month">
                    <div class="day-number">${prevLastDay.getDate() - x + 1}</div>
                </div>`;
            }

            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const dayEvents = events.filter(e => e.date === dateStr);
                
                const isToday = i === currentDate.getDate() && 
                               currentMonth === currentDate.getMonth() && 
                               currentYear === currentDate.getFullYear();

                let eventsHtml = '';
                dayEvents.forEach(event => {
                    eventsHtml += `<div class="event-dot event-${event.location}">${event.title}</div>`;
                });

                days += `<div class="day ${isToday ? 'today' : ''}" onclick="showDayEvents('${dateStr}')">
                    <div class="day-number">${i}</div>
                    ${eventsHtml}
                </div>`;
            }

            for (let j = 1; j <= nextDays; j++) {
                days += `<div class="day other-month">
                    <div class="day-number">${j}</div>
                </div>`;
            }

            document.getElementById('calendarDays').innerHTML = days;
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        function showDayEvents(dateStr) {
            const dayEvents = events.filter(e => e.date === dateStr);
            
            if (dayEvents.length === 0) return;

            const date = new Date(dateStr + 'T00:00:00');
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('modalDate').textContent = date.toLocaleDateString('en-US', options);

            let eventsHtml = '';
            dayEvents.forEach(event => {
                eventsHtml += `
                    <div class="event-detail" style="border-color: ${
                        event.location === 'avr' ? '#667eea' : 
                        event.location === 'court' ? '#28a745' : '#fd7e14'
                    }">
                        <h3>${event.title}</h3>
                        <p><strong>‚è∞ Time:</strong> ${event.time}</p>
                        <p><strong>üìç Location:</strong> ${event.locationName}</p>
                        <p><strong>üë§ Organizer:</strong> ${event.organizer}</p>
                        <p><strong>üìß Email:</strong> ${event.email}</p>
                        <p><strong>üì± Contact:</strong> ${event.contact}</p>
                        <p><strong>üé´ Type:</strong> ${event.participantType}</p>
                        <p><strong>üÜî Reg ID:</strong> ${event.registrationId}</p>
                        <button class="delete-btn" onclick="deleteEvent(${event.id})">üóëÔ∏è Delete Event</button>
                    </div>
                `;
            });

            document.getElementById('modalEvents').innerHTML = eventsHtml;
            document.getElementById('eventModal').classList.add('active');
        }

        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                events = events.filter(e => e.id !== eventId);
                closeModal();
                renderCalendar();
            }
        }

        function closeModal() {
            document.getElementById('eventModal').classList.remove('active');
        }

        document.getElementById('eventModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Registration Link QR Code Functions
        let registrationLinkQRCode = null;

        function showRegistrationQR() {
            const currentUrl = window.location.href;
            
            // Clear previous QR code
            const qrContainer = document.getElementById('registration-link-qr');
            qrContainer.innerHTML = '';

            // Generate QR code for current page URL
            registrationLinkQRCode = new QRCode(qrContainer, {
                text: currentUrl,
                width: 300,
                height: 300,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            // Display URL
            document.getElementById('current-url').textContent = currentUrl;

            // Show modal
            document.getElementById('registrationQRModal').classList.add('active');
        }

        function closeRegistrationQRModal() {
            document.getElementById('registrationQRModal').classList.remove('active');
        }

        function downloadRegistrationQR() {
            const qrCanvas = document.querySelector('#registration-link-qr canvas');
            if (qrCanvas) {
                const url = qrCanvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = url;
                link.download = 'EJNHS_Registration_Form_QRCode.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                alert('‚úÖ QR Code downloaded successfully!');
            }
        }

        function printRegistrationQR() {
            const originalContent = document.body.innerHTML;
            const qrContent = document.getElementById('registrationQRModal').querySelector('.modal-content').innerHTML;
            
            document.body.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h1 style="margin-bottom: 20px;">EJNHS Event Registration</h1>
                    <p style="margin-bottom: 30px; font-size: 18px;">Scan to Register for Events</p>
                    ${document.getElementById('registration-link-qr').outerHTML}
                    <p style="margin-top: 30px; font-size: 14px; color: #666;">${document.getElementById('current-url').textContent}</p>
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        }

        // Close registration QR modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('registrationQRModal');
            if (e.target === modal) {
                closeRegistrationQRModal();
            }
        });

        // Initial render
        renderCalendar();
    </script>
</body>
</html>